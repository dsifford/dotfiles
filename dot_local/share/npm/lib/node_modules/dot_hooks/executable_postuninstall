#!/usr/bin/env bash

NPM_PACKAGES_FILE="/home/dsifford/.local/share/chezmoi/.data/packages.npm.yml"

if [[ ! -f $NPM_PACKAGES_FILE ]]; then
    touch "$NPM_PACKAGES_FILE"
fi
npm_config_argv=${npm_config_argv:?}

declare -a package_list

mapfile -t package_list < <(
    comm -23 <(
        yq '.[0].npm | sort[]' "$NPM_PACKAGES_FILE"
    ) <(
        jq '.remain | sort[]' <<< "$npm_config_argv"
    )
)

{
    echo '#'
    echo '# THIS IS A GENERATED FILE. DO NOT EDIT DIRECTLY.'
    echo '#'
    echo '- npm:'
    printf -- '  - %s\n' "${package_list[@]}"
} > "$NPM_PACKAGES_FILE"
